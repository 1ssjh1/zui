/*!
 * ZUI: 下拉选择器 - v1.10.0 - 2022-05-20
 * http://openzui.com
 * GitHub: https://github.com/easysoft/zui.git 
 * Copyright (c) 2022 cnezsoft.com; Licensed MIT
 */
!function(e,t,i){"use strict";var o="zui.picker",r={},n={lang:null,remote:null,remoteConverter:null,remoteOnly:!1,onRemoteError:null,disableEmptySearch:!1,textKey:"text",valueKey:"value",keysKey:"keys",multi:"auto",formItem:"auto",list:null,allowSingleDeselect:null,autoSelectFirst:!1,maxSelectedCount:0,maxListCount:50,hideEmptyTextOption:!0,searchValueKey:!0,emptyResultHint:null,hideOnScroll:!0,inheritFormItemClasses:!1,emptySearchResultHint:null,accurateSearchHint:null,remoteErrorHint:null,deleteByBackspace:!0,disableScrollOnShow:!0,maxDropHeight:250,dropDirection:"auto",dropWidth:"100%",maxAutoDropWidth:450,multiValueSplitter:",",multiSelectActions:5,searchDelay:200,autoClearDrop:6e4,fixLabelFor:!0,hotkey:!0,onSelect:null,onDeselect:null,onBeforeChange:null,onChange:null,onReady:null,onNoResults:null,onShowingDrop:null,onHidingDrop:null,onShowedDrop:null,onHiddenDrop:null,valueMustInList:!0},l={zh_cn:{emptyResultHint:"没有可选项",emptySearchResultHint:"没有找到 “{0}”",accurateSearchHint:"请提供更多关键词缩小匹配范围",remoteErrorHint:"无法从服务器获取结果 - {0}",selectAll:"全选",deselectAll:"取消选择"},zh_tw:{emptyResultHint:"沒有可選項",emptySearchResultHint:"沒有找到 “{0}”",accurateSearchHint:"請提供更多關鍵詞縮小匹配範圍",remoteErrorHint:"無法從服務器獲取結果 - {0}",selectAll:"全選",deselectAll:"取消選擇"},en:{emptyResultHint:"No options",emptySearchResultHint:'Cannot found "{0}"',accurateSearchHint:"Suggest to provide more keywords",remoteErrorHint:"Unable to get result from server: {0}",selectAll:"Select all",deselectAll:"Deselect all"}},s=function(r,n){var a=this;a.name=o,a.$=e(r),a.id="pk_"+(a.$.attr("id")||e.zui.uuid()),n=a.options=e.extend({},s.DEFAULTS,this.$.data(),n),void 0!==n.hideOnWindowScroll&&(n.hideOnScroll=n.hideOnWindowScroll);var c=e.zui.clientLang?e.zui.clientLang():"en",p=n.lang||c;a.lang=e.zui.getLangData?e.zui.getLangData(o,p,l):l[p]||l[c];var u,d,h=n.formItem,v='.form-item,input[type="hidden"],select,input[type="text"]';if(u="self"===h?a.$:"auto"!==h&&h?a.$.find(h):a.$.is(v)?a.$:a.$.find(v).first(),!u.length)return console.error&&console.error("Cannot found form item for picker.");if(u.is('input[type="hidden"]'))d="hidden";else if(u.is("select"))d="select";else{if(!u.is('input[type="text"]'))return console.error&&console.error("Unknown form type for picker.");d="text"}n.inheritFormItemClasses&&m.addClass(u.attr("class")),a.formType=d,a.$formItem=u.removeClass("picker").hide(),a.selfFormItem=u.is(a.$);var f=n.multi;f&&"auto"!==f||(f="select"===d&&"multiple"===u.attr("multiple")),f=!!f,a.multi=f;var g=n.list;g?a.setList("function"==typeof g?g({search:a.search,limit:n.maxListCount}):g,!0):"select"===d?a.updateFromSelect():a.setList([],!0);var m;m=!a.selfFormItem&&a.$.hasClass("picker")?a.$:e('<div class="picker" />').insertAfter(a.$),m.addClass("picker").toggleClass("picker-multi",f).toggleClass("picker-single",!f);var y=m.children(".picker-selections");y.length?y.empty():y=e('<div class="picker-selections" />');var k=a.id+"-search",S=e('<input autocomplete="off" id="'+k+'" type="text" class="picker-search">').appendTo(y);if(!f){var L=e('<div class="picker-selection picker-selection-single"><span class="picker-selection-text"></span></div>');n.allowSingleDeselect&&L.append('<span class="picker-selection-remove"></span>'),L.appendTo(y),a.$singleSelection=L}m.toggleClass("picker-input-empty",!S.val().length).append(y),a.$container=m,a.$selections=y,a.$search=S,a.search="";var b=n.placeholder;if(void 0===b&&(b=u.attr("placeholder")),"string"==typeof b&&b.length&&y.append(e('<div class="picker-placeholder" />').text(b)),n.placeholder=b,n.fixLabelFor){var x=u.attr("id");x&&e('label[for="'+x+'"]').attr("for",k)}var $=void 0!==n.defaultValue?n.defaultValue:u.val();if(a.setValue($,!0),S.on("focus",function(){a._blurTimer&&(clearTimeout(a._blurTimer),a._blurTimer=0),m.addClass("picker-focus"),a.showDropList()}).on("blur",function(){a._blurTimer&&clearTimeout(a._blurTimer),a._blurTimer=setTimeout(function(){a._blurTimer=0,S.is(":focus")||m.removeClass("picker-focus")},100)}).on("input change",function(){var e=S.val();f&&S.width(14*e.length),m.toggleClass("picker-input-empty",!e.length),a.tryUpdateList(e)}),n.hotkey&&S.on("keydown",function(e){var t=e.key||e.which;if(a.dropListShowed){var i=a.activeValue,o="string"==typeof i;if("Enter"===t||13===t)o&&(a.select(i,f),f?(a.$search.val(""),a.tryUpdateList("")):S.blur(),e.preventDefault());else if("ArrowDown"===t||40===t){var r,l=a.$activeOption;if(l&&(r=l.next(".picker-option"),f))for(;r.length&&r.hasClass("picker-option-selected");)r=r.next(".picker-option");r&&r.length||(r=a.$optionsList.children(f?".picker-option:not(.picker-option-selected)":".picker-option").first()),r.length&&a.activeOption(r),e.preventDefault()}else if("ArrowUp"===t||30===t){var s,l=a.$activeOption;if(l&&(s=l.prev(".picker-option"),f))for(;s.length&&s.hasClass("picker-option-selected");)s=s.prev(".picker-option");s&&s.length||(s=a.$optionsList.children(f?".picker-option:not(.picker-option-selected)":".picker-option").last()),s.length&&a.activeOption(s),e.preventDefault()}else"Escape"===t||27===t?a.hideDropList(!0):n.deleteByBackspace&&f&&("Backspace"===t||8===t)&&a.value&&a.value.length&&!S.val().length&&a.deselect(a.value[a.value.length-1])}}),f){y.on("mousedown",function(e){if(a.dropListShowed)return e.preventDefault(),void e.stopPropagation()}).on("mouseup",function(t){y.hasClass("sortable-sorting")||e(t.target).closest(".picker-selection-remove").length||a.dropListShowed||a.focus()});var C=n.sortValuesByDnd;if(C&&e.fn.sortable){m.addClass("picker-sortable");var w={selector:".picker-selection",stopPropagation:!0,start:function(){a.hideDropList(!0)},finish:function(t){var i=[];e.each(t.list,function(e,t){i.push(t.item.data("value"))}),a.setValue(i.slice(),!1,!0)}};"object"==typeof C&&e.extend(w,C),y.sortable(w)}}if(y.on("click",".picker-selection-remove",function(t){if(a.multi){var i=e(this).closest(".picker-selection");a.deselect(i.data("value"))}else a.deselect();t.stopPropagation()}),u.on("chosen:updated",function(){a.updateFromSelect(),a.setValue(u.val(),!0),a.updateList()}).on("chosen:activate",a.focus).on("chosen:open",a.showDropList).on("chosen:close",a.hideDropList),m.addClass("picker-ready"),e.zui.asap(function(){a.triggerEvent("ready",{picker:a},"","chosen:ready")}),!n.disableScrollOnShow){var D=n.hideOnScroll;D&&![t,i,!0].includes(D)&&e(D).on("scroll",this.handleParentScroll.bind(this))}};s.prototype.destroy=function(){var t=this,i=t.options;t.hideDropList(!0);var r=t.$search;r.off("focus blur input change"),i.hotkey&&r.off("keydown"),r.remove();var n=t.$selections;n.off("click"),t.multi&&n.off("mousedown mouseup"),n.remove();var l=t.$formItem;t.selectOptionsBackup&&(l.empty(),e.each(t.selectOptionsBackup,function(t,o){var r={value:o[i.valueKey]},n=o[i.keysKey];void 0!==n&&(r["data-"+i.keysKey]=n),l.append(e("<option />").attr(r).text(o[i.textKey]))})),l.off("chosen:updated chosen:activate chosen:open chosen:close").val(t.value).show(),!t.selfFormItem&&t.$.hasClass("picker")||t.$container.remove(),this.destroyDropList(0),t.$.data(o,null)},s.prototype.focus=function(){this.$search.focus()},s.prototype.select=function(e,t){var i=this;if(!i.isSelectedValue(e)){if(i.triggerEvent("select",{value:e,picker:i})===!1)return;if(i.multi){var o=i.value;o=o?o.slice():[],o.push(e),i.setValue(o)}else i.setValue(e)}t||i.hideDropList()},s.prototype.deselect=function(e){var t=this;if(t.multi){if(!t.isSelectedValue(e))return;if(t.triggerEvent("deselect",{value:e,picker:t})===!1)return;var i=t.value;if(i&&i.length)for(var o=0;o<i.length;++o)if(i[o]===e){i=i.slice(),i.splice(o,1),t.setValue(i);break}}else t.setValue("")},s.prototype.selectAll=function(e){var t=this;if(t.multi&&!t.options.remote){for(var i=[],o=0;o<t.list.length;++o){var r=t.list[o],n=r[t.options.valueKey];i.push(n)}t.setValue(i),e||t.hideDropList()}},s.prototype.deselectAll=function(e){var t=this;t.multi&&!t.options.remote&&(t.setValue([]),e||t.hideDropList())},s.prototype.updateMessage=function(e,t,i){var o=this,r=o.$message,n="string"==typeof e&&e.length;e=n?e:"",o.hasMessage=n,r.attr("title",e).text(e).attr("data-type",t),o.$dropMenu.toggleClass("picker-has-message",!!n),i||"top"!==o.dropDirection||o.layoutDropList()},s.prototype.getRemoteList=function(t,i){var o=this,r=o.options.remote;if(r){var n=o.options,l=o.search;if("string"==typeof l&&!l.length&&n.disableEmptySearch)return o.setList([]),void t(!1);var s,a={search:l,limit:n.maxListCount};if(s="string"==typeof r?{url:r}:"function"==typeof r?r(a,o):r,!s.url)return void console.warn("Remote url must provide to get remote list in picker.");var c=!1;s.url.indexOf("{search}")>-1&&(s.url=s.url.replace(/\{search\}/g,l),c=!0),s.url.indexOf("{limit}")>-1&&(s.url=s.url.replace(/\{limit\}/g,n.maxListCount),c=!0),o.updateMessage(""),o.$container.addClass("picker-loading"),o.remoteXhr&&o.remoteXhr.abort(),o.remoteXhr=e.ajax(e.extend({dataType:"json",dataFilter:n.remoteConverter,data:c?null:a},s)).done(function(i,r,l){var s=!1;if(i){if(e.isPlainObject(i))if("success"!==i.result&&"ok"!==i.result||!Array.isArray(i.data))if("fail"===i.result)o.updateMessage(i.message||JSON.stringify(i),"danger");else{var a=[];e.each(i,function(t,i){var o={};o[n.valueKey]=t,"object"==typeof i?e.extend(o,i):o[n.textKey]=i,a.push(o)}),i=a}else i=i.data;Array.isArray(i)&&(s=i.length,o.setList(i,n.remoteOnly))}t&&t(s)}).fail(function(e,t){var r,l=n.onRemoteError;r="function"==typeof l?l(e,t):"string"==typeof l?l:(n.remoteErrorHint||o.lang.remoteErrorHint).format(t||""),o.updateMessage(r,"danger"),i&&i()}).always(function(){o.remoteXhr=null,o.$container.removeClass("picker-loading")})}},s.prototype.layoutDropList=function(i,o,r){var n=this;if(n.$dropMenu){var l=n.options,s=l.maxDropHeight||Number.MAX_VALUE,a=n.$dropMenu,c=n.$optionsList;i||a.css({opacity:0,width:"auto","max-width":"none"}),c.css({"max-height":s}),e.zui.asap(function(){var i=n.$selections[0].getBoundingClientRect(),p=o?l.dropDirection:n.dropDirection||l.dropDirection;"function"==typeof p&&(p=p(i,n));var u=l.maxAutoDropWidth,d=e(t),h=d.height(),v=n.hasMessage?n.$message.outerHeight():0,f=n.showActions?n.$actions.outerHeight():0,g=Math.max(f,v,a.height()),m=l.dropWidth||"auto",y={left:i.left,opacity:1};"auto"===p&&(p=i.top+i.height+g>h&&i.top>h-i.top-i.height?"top":"bottom"),n.dropDirection=p;var k=Math.min(s,"bottom"===p?h-i.top-i.height:i.top);if(g=Math.min(g,k),y.top="bottom"===p?i.top+i.height:i.top-g,"100%"===m)y.width=i.width;else if("auto"===m){if(y.width="auto",y.maxWidth="auto"===u?i.width:u,n.multi){var S=n.$search[0].getBoundingClientRect();y.left=S.left}}else y.width=m;var L=g-v-f;c.css("max-height",L),a.css(y),r&&r()})}},s.prototype.tryUpdateList=function(e){var t=this;t.search!==e&&(t.search=e,t.updateListTimer&&clearTimeout(t.updateListTimer),t.updateListTimer=setTimeout(function(){t.updateListTimer=null,t.updateList()},t.options.searchDelay))},s.prototype.renderOptionsList=function(t,o){var r=this,n=r.$optionsList;if(void 0===t?t=r.optionsList:r.optionsList=t,n){var l="",s=r.options,a=r.search,c="string"==typeof a&&a.length,p=0;if(t.length){for(var u,d,h,v=s.maxListCount,f=s.valueKey,g=s.textKey,m=s.showMultiSelectedOptions,y=v?Math.min(t.length,v):t.length,k=a.toLowerCase(),S=n.children(".picker-option").addClass("picker-expired"),L=r.activeValue,b=void 0!==L&&null!==L,x=0;x<y;++x){var $=t[x],C=$[f],w=r.isSelectedValue(C);if(m||!w||!r.multi){var D=$[g];if(C.length&&(!s.hideEmptyTextOption||D.length)){p++;var _=r.getItemID($,"option"),O=e(i.getElementById(_));O.length?O.removeClass("picker-expired"):O=e('<a class="picker-option" id="'+_+'" data-value="'+C+'"><span class="picker-option-text"></span><span class="picker-option-keys"></span></a>'),O.attr("title",D).removeClass(".picker-option-active").toggleClass("picker-option-selected",w);var M=O.find(".picker-option-text");if(c){var T=D.toLowerCase(),V=T.split(k);if(V.length>1){M.empty();var I=0,A=V[0].length;A&&(M.append(e("<span>").text(D.substr(I,A))),I+=A);for(var E=1;E<V.length;++E)M.append(e('<span class="picker-option-text-matched">').text(D.substr(I,a.length))),I+=a.length,A=V[E].length,A&&(M.append(e("<span>").text(D.substr(I,A))),I+=A)}else M.text(D)}else M.text(D);if(s.optionRender){var K=s.optionRender(O,$,r);K instanceof e&&(O=K)}O.appendTo(n),r.multi?w||d||(d=$):!h&&b&&C===L?h=$:w?u=$:d||(d=$)}}}S.filter(".picker-expired").remove(),!o&&y<t.length&&(l=s.accurateSearchHint||r.lang.accurateSearchHint),r.activeOption(h||u||d)}else n.empty();p||o||(l=c?(s.emptySearchResultHint||r.lang.emptySearchResultHint).format(a):s.emptyResultHint||r.lang.emptyResultHint,c&&r.triggerEvent("noResults",{search:a,picker:r},"","chosen:no_results"));var R=!1;if(r.multi&&!s.remote){var H=s.multiSelectActions;H&&("number"!=typeof H&&(H=1),t.length>=H&&(R=!0,r.$actions.find('[data-type="select-all"]').attr("disabled",n.children(".picker-option").length?null:"disabled"),r.$actions.find('[data-type="deselect-all"]').attr("disabled",r.value&&r.value.length?null:"disabled")))}r.showActions=R,r.$dropMenu.toggleClass("picker-no-actions",!R),o||r.updateMessage(l,"info"),r.$dropMenu.toggleClass("picker-no-options",!p),r.layoutDropList(r.listRendered),r.listRendered=!0}},s.prototype.activeOption=function(t,i){var o=this;t&&(t instanceof e?t=t.attr("data-value"):"object"==typeof t&&(t=t[o.options.valueKey]));var r=o.getListItem(t);r?o.activeValue=t:t=o.activeValue,o.$optionsList.find(".picker-option-active").removeClass("picker-option-active");var n=o.$optionsList.find('[data-value="'+t+'"]');if(n.length){if(n.addClass("picker-option-active"),!i){var l=n[0];l.scrollIntoViewIfNeeded?l.scrollIntoViewIfNeeded():l.scrollIntoView&&l.scrollIntoView()}o.$activeOption=n}else o.$activeOption=null},s.prototype.updateList=function(e,t,i){var o=this;void 0!==e?o.search=e:e=o.search;var r=o.options.remoteOnly;if(r)o.layoutDropList(!1,!0);else{var n=[];if(null===e||void 0===e||"string"==typeof e&&!e.length)n=o.list||[];else if("function"==typeof o.options.list)n=o.options.list({search:e,limit:o.options.maxListCount});else if(o.list&&o.list.length){var l=o.options.maxListCount,s=o.options.keysKey,a=o.options.textKey,c=o.options.valueKey,p=o.options.searchValueKey,u={};e=e.toLowerCase();for(var d=0;d<o.list.length;++d){var h=o.list[d],v=h[c];if(!o.multi||!o.isSelectedValue(v)){var f=0,g=h[a];if(null!==g&&void 0!==g&&""!==g){g=g.toLowerCase();var m=g.indexOf(e);m>-1&&(f+=0===m?20:10)}if(!f){var y=h[s];if(null!==y&&void 0!==y&&""!==y){y=y.toLowerCase();var m=y.indexOf(e);m>-1&&(f+=0===m?8:4)}}if(!f&&p&&null!==v&&void 0!==v&&""!==v){v=v.toLowerCase();var m=v.indexOf(e);m>-1&&(f+=0===m?3:1)}if(f&&(u[v]=f+(o.list.length-d)/o.list.length,n.push(h)),l&&n.length>=l)break}}n.length&&(n=n.sort(function(e,t){return u[t[c]]-u[e[c]]}))}o.renderOptionsList(n,!1,i)}t||o.getRemoteList(function(t){r?o.renderOptionsList(o.list,!1,i):o.updateList(e,!0)},r?function(){o.renderOptionsList([],!0,i)}:null)},s.prototype.destroyDropList=function(e){var t=this;t._clearTimer&&clearTimeout(t._clearTimer),t.$dropMenu&&(e?t._clearTimer=setTimeout(t.destroyDropList.bind(t,0),e):(t.$optionsList.off("click mouseenter"),t.$optionsList=null,t.$dropMenu.remove(),t.$dropMenu=null,t.$message=null))},s.prototype.showDropList=function(){var t=this;if(t.triggerEvent("showingDrop",{picker:t})!==!1){if(t._clearTimer&&clearTimeout(t._clearTimer),t.dropListShowed=!0,t.dropDirection=null,t.listRendered=!1,t.activeValue=null,r[t.id]=t,t.options.disableScrollOnShow&&e.zui.fixBodyScrollbar(),!t.$dropMenu){var i=e('<div class="picker-drop-menu" id="pickerDropMenu-'+t.id+'"></div>').attr("data-id",t.id),n=e('<div class="picker-option-list"></div>').appendTo(i);i.data(o,t).toggleClass("picker-multi",t.multi).toggleClass("picker-single",!t.multi).appendTo("body"),t.options.chosenMode&&i.addClass("chosen-up"),n.on("click",".picker-option",function(){t.select(e(this).attr("data-value"))}).on("mouseenter",".picker-option",function(){t.activeOption(e(this),!0)}),t.multi&&!t.options.remote&&(t.$actions=e(['<div class="picker-actions">','<button type="button" class="btn btn-sm btn-link picker-action" data-type="select-all">'+t.lang.selectAll+"</button>",'<button type="button" class="btn btn-sm btn-link picker-action" data-type="deselect-all">'+t.lang.deselectAll+"</button>","</div>"].join("")).appendTo(i),t.$actions.on("click",".picker-action",function(i){var o=e(this).data("type");"select-all"===o?t.selectAll():"deselect-all"===o&&t.deselectAll()})),t.$message=e('<div class="picker-message"></div>').appendTo(i),t.$dropMenu=i,t.$optionsList=n}t.updateList(t.search,!1,function(){t.triggerEvent("showedDrop",{picker:t},"","chosen:showing_dropdown")}),t.$dropMenu.addClass("picker-drop-show")}},s.prototype.hideDropList=function(t){var i=this;if(i.triggerEvent("hidingDrop",{picker:i})!==!1){i.dropListShowed=!1,i.$activeOption=null,i.activeValue=null,i.$search.val(""),i.search="",delete r[i.id],i.$dropMenu&&i.$dropMenu.removeClass("picker-drop-show"),i.options.disableScrollOnShow&&e.zui.resetBodyScrollbar(),t&&this.$search.blur(),i.triggerEvent("hiddenDrop",{picker:i},"","chosen:hiding_dropdown");var o=i.options.autoClearDrop;o&&i.destroyDropList(o)}},s.prototype.updateFromSelect=function(t){var i=this,o=i.options,r=[];void 0===t&&(t=!0),i.$formItem.children("option").each(function(){var t=e(this),n=t.val(),l=t.text();if(o.onUpdateSelectOption){var s=o.onUpdateSelectOption(t,i);s&&r.push(s)}else if(l.length||n.length){var s={};s[o.valueKey]=n,s[o.textKey]=l,s[o.keysKey]=t.data(o.keysKey),r.push(s)}var a=o.allowSingleDeselect;"auto"!==a&&null!==a&&void 0!==a||n.length||(o.allowSingleDeselect=!0)}),i.selectOptionsBackup=r.slice(),i.setList(r,t)},s.prototype.setList=function(e,t){var i=this,o=i.options,r=t?[]:i.list||[],n=t?{}:i.listMap||{};"string"==typeof e&&(e=e.split(o.multiValueSplitter));for(var l=0;l<e.length;++l){var s=e[l];if("string"==typeof s){var a={};a[o.textKey]=s,a[o.valueKey]=String(l),s=a}else if(Array.isArray(s)){var a={};a[o.textKey]=s[0],a[o.valueKey]=s[1],a[o.keysKey]=s[2],s=a}var c=s[o.valueKey];"string"!=typeof c&&(c=String(c),s[o.valueKey]=c);var p=n[c];p?(s.index=p.$_index,r[p.$_index]=s,n[c]=s):(s.$_index=r.length,n[c]=s,r.push(s))}i.list=r,i.listMap=n},s.prototype.removeFromList=function(e){var t=this,i=t.list||[];if(i.length){var o=t.options;"string"==typeof e&&(e=e.split(o.multiValueSplitter));for(var r={},n=0;n<e.length;++n){var l=e[n];r["object"==typeof l?l[o.valueKey]:l]=!0}for(var s=[],a={},n=0;n<i.length;++n){var l=i[n],c=l[o.valueKey];r[c]||(s.push(l),a[c]=l)}t.list=s,t.listMap=a,t.setValue(t.multi?t.value.slice():t.value)}},s.prototype.getItemID=function(e,t){var i=this.id+"-item-"+encodeURIComponent(e[this.options.valueKey]);return void 0!==t?i+"-"+t:i},s.prototype.isSelectedValue=function(t){var i=this;if(void 0===i.value||null===i.value)return!1;if("string"!=typeof t&&(t=String(t)),i.multi){if(!i.valueSet)if(void 0!==typeof Set)i.valueSet=new Set(i.value);else{i.valueSet={};for(var o=0;o<i.value.length;++o)i.valueSet[i.value[o]]=!0}return e.isPlainObject(i.valueSet)?!!i.valueSet[t]:i.valueSet.has(t)}return t===i.value},s.prototype.getValue=function(){return that.value},s.prototype.getListItem=function(e){return this.listMap[e]},s.prototype.hasListItem=function(e){return void 0!==this.listMap[e]},s.prototype.triggerEvent=function(e,t,i,o){var r=this;if(Array.isArray(t)||(t=[t]),r.$.trigger(e,t),r.options.chosenMode&&o&&r.$.trigger(o,t),i=i===!0?e:i||"on"+e[0].toUpperCase()+e.substr(1),"function"==typeof r.options[i])return r.options[i].apply(r,t)},s.prototype.setValue=function(t,o,r){var n,l=this,s=l.options,a=l.multi;if(void 0===t&&(t=l.$formItem.val()),null===t&&(t=""),a&&"string"==typeof t?t=t.split(s.multiValueSplitter):a||"string"==typeof t||(t=String(t)),s.valueMustInList&&!s.remoteOnly)if(a&&t){for(var c=[],p=0;p<t.length;++p){var u=t[p];l.hasListItem(u)&&c.push(u)}c.length!==t.length&&(t=c)}else a||l.hasListItem(t)||(t=void 0!==s.defaultValue?s.defaultValue:"");if(a&&l.value&&t?l.value.join(s.multiValueSplitter)!==t.join(s.multiValueSplitter):l.value!==t){if(!o&&l.triggerEvent("beforeChange",{value:t,oldValue:l.value},!0)===!1)return;l.value=t,n=!0}a&&(l.valueSet=null);var d=l.$formItem;if("select"===l.formType){var h=s.chosenMode;h||d.empty(),a?e.each(t,function(e,t){h&&d.find('option[value="'+t+'"]').length||d.append('<option value="'+t+'">')}):h&&d.find('option[value="'+t+'"]').length||d.append('<option value="'+t+'">')}if(d.val(t),!r){var v=!1,f=s.selectionTextRender||function(e,t,i){e.text(t)};if(a){var g=l.$selections,m=g.children(".picker-selection").addClass("picker-expired");e.each(t,function(t,o){void 0===o||null===o?o="":"string"!=typeof o&&(o=String(o));var r=l.getListItem(o);if(r){v=!0;var n=r[s.textKey],a=l.getItemID(r,"selection"),c=e(i.getElementById(a));c.length?c.removeClass("picker-expired"):c=e('<div class="picker-selection" id="'+a+'"><span class="picker-selection-text"></span><span class="picker-selection-remove"></span></div>').data("value",o),f(c.find(".picker-selection-text"),n,r),c.attr("title",n).insertBefore(l.$search)}}),m.filter(".picker-expired").remove()}else{var y=l.getListItem(t);v=!!y,f(l.$singleSelection.find(".picker-selection-text"),v?y[s.textKey]:"",y)}l.$container.toggleClass("picker-no-value",!v).toggleClass("picker-has-value",v)}l.dropListShowed&&l.renderOptionsList(),n&&(s.onChange&&s.onChange(t),o||l.triggerEvent("change",{value:t,picker:l}),l.$[0]!==d[0]&&d.change()),l.$search.is(":focus")||l.$container.removeClass("picker-focus")},s.prototype.handleParentScroll=function(t,o){var r=this;if(!r.options.disableScrollOnShow&&r.dropListShowed){var n=r.options.hideOnScroll&&(!o||t.target===i);r.scrollEventTimer&&e.zui.clearAsap(r.scrollEventTimer),n&&r.$dropMenu.css("opacity",0),r.scrollEventTimer=e.zui.asap(function(){if(r.scrollEventTimer=null,r.dropListShowed){var e=(t.target===i?i.body:t.target).getBoundingClientRect(),o=r.$selections[0].getBoundingClientRect();o.bottom<e.top||o.top>e.bottom?r.hideDropList(!0):r.layoutDropList(!0,!0)}},n?500:0)}},s.DEFAULTS=n,s.NAME=o,s.SHOWS=r,s.convertChosenOptions=function(t){var i=!1;return e.each({allow_single_deselect:"allowSingleDeselect",inherit_select_classes:"inheritFormItemClasses",max_selected_options:"maxSelectedCount",no_results_text:"emptySearchResultHint",placeholder_text:"placeholder",placeholder_text_multiple:"placeholder",placeholder_text_single:"placeholder",single_backstroke_delete:"deleteByBackspace",display_selected_options:"showMultiSelectedOptions",drop_direction:"dropDirection",drop_width:"dropWidth",max_drop_width:"maxAutoDropWidth",highlight_selected:"autoSelectFirst",sort_value_splitter:"multiValueSplitter"},function(e,o){var r=t[e];void 0!==r&&(t[o]=r,delete t[e],i=!0)}),i&&(t.chosenMode=!0),t},e.fn.picker=function(t,i){return this.each(function(){var r=e(this),n=r.data(o),l="object"==typeof t&&t;n?"string"==typeof t&&n[t](i):((s.enabledChosenMode||l&&l.chosenMode)&&(l=s.convertChosenOptions(e.extend({},r.data(),l))),r.data(o,n=new s(this,l)))})},e.fn.picker.Constructor=s,e.Picker=e.zui.Picker=s,s.enableChosen=function(){s.enabledChosenMode||(e.fn.chosen=function(t,i){return this.each(function(){var r=e(this),n=r.data(o);if(!n){var l=e.extend({},r.data(),"object"==typeof t?t:null);return n=new s(this,s.convertChosenOptions(l)),void r.data(o,n)}"string"==typeof t&&n[t](i)})},e.fn._chosen=e.fn.chosen,s.enabledChosenMode=!0)},e.zui.fixBodyScrollbar&&e.zui({_scrollbarWidth:0,checkBodyScrollbar:function(){if(i.body.clientWidth>=t.innerWidth)return 0;if(!e.zui._scrollbarWidth){var o=i.createElement("div");o.className="modal-scrollbar-measure scrollbar-measure",i.body.appendChild(o),e.zui._scrollbarWidth=o.offsetWidth-o.clientWidth,i.body.removeChild(o)}return e.zui._scrollbarWidth},fixBodyScrollbar:function(){if(e.zui.checkBodyScrollbar()){var t=e("body"),i=parseInt(t.css("padding-right")||0,10);return e.zui._scrollbarWidth&&t.css({paddingRight:i+e.zui._scrollbarWidth,overflowY:"hidden"}),!0}},resetBodyScrollbar:function(){e("body").css({paddingRight:"",overflowY:""})}}),e(function(){e('[data-toggle="picker"]').picker(),e(i).on("mousedown",function(t){var i=e(t.target).closest(".picker,.picker-drop-menu"),o=i.length;e.each(r,function(e,t){o&&(i.is(t.$container)||t.$dropMenu&&i.is(t.$dropMenu))||t.hideDropList()})}),e(t).on("scroll",function(t){e.each(r,function(e,i){i.handleParentScroll(t,!0)})})})}(jQuery,window,document);